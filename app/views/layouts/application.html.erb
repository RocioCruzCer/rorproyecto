<!DOCTYPE html>
<html>
<head>
  <title>Contador de Interacciones</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  
  <!-- Cargar reCAPTCHA de Google -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  
  <!-- Fuente Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome para iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <style>
    /* Reset y configuración base */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #FAF5E9; /* Fondo principal claro */
      color: #2F2F2A; /* Texto principal */
      line-height: 1.6;
      min-height: 100vh;
    }
    
    /* Layout container */
    .app-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    /* Menú hamburguesa - INICIALMENTE CERRADO */
    .sidebar {
      width: 280px;
      background-color: #0B5D3B; /* Verde oscuro */
      height: 100vh;
      position: fixed;
      left: -280px; /* Fuera de pantalla por defecto */
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1000;
      padding-top: 80px;
      box-shadow: 4px 0 20px rgba(11, 93, 59, 0.2);
    }
    
    .sidebar.active {
      left: 0; /* Se muestra cuando está activo */
    }
    
    .menu-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      background-color: #0B5D3B; /* Verde oscuro */
      color: #FAF5E9; /* Texto claro */
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 12px;
      cursor: pointer;
      z-index: 1001;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(11, 93, 59, 0.3);
    }
    
    .menu-toggle:hover {
      background-color: #0A4D32;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(11, 93, 59, 0.4);
    }
    
    .menu-toggle.active {
      left: 300px;
      background-color: #E0B100; /* Dorado cuando está activo */
      color: #2F2F2A;
    }
    
    .sidebar-header {
      padding: 30px 25px;
      text-align: center;
      border-bottom: 1px solid rgba(250, 245, 233, 0.1);
      margin-bottom: 20px;
    }
    
    .sidebar-header h2 {
      color: #FAF5E9;
      font-size: 22px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    .sidebar-header p {
      color: #6F8F7A; /* Verde medio */
      font-size: 14px;
      margin-top: 5px;
    }
    
    .menu-items {
      list-style: none;
      padding: 0 15px;
    }
    
    .menu-items li {
      margin-bottom: 8px;
    }
    
    .menu-item {
      padding: 16px 20px;
      color: #E4DDC9; /* Texto claro secundario */
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 15px;
      border-radius: 10px;
      font-weight: 500;
      text-decoration: none;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
    }
    
    .menu-item:hover {
      background-color: rgba(111, 143, 122, 0.2); /* Verde medio con transparencia */
      color: #FAF5E9;
      transform: translateX(5px);
    }
    
    .menu-item.active {
      background-color: #E0B100; /* Dorado */
      color: #2F2F2A;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(224, 177, 0, 0.3);
    }
    
    .menu-item i {
      width: 24px;
      text-align: center;
      font-size: 18px;
    }
    
    .menu-item.active i {
      color: #2F2F2A;
    }
    
    /* Overlay para cerrar menú */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(47, 47, 42, 0.5); /* Oscuro semitransparente */
      z-index: 999;
      display: none;
      backdrop-filter: blur(3px);
    }
    
    .overlay.active {
      display: block;
    }
    
    /* HEADER UNIFICADO CON MENÚ Y BREADCRUMBS */
    .header-container {
      position: sticky;
      top: 0;
      z-index: 100;
      background: linear-gradient(135deg, #FAF5E9 0%, #E4DDC9 100%);
      border-bottom: 1px solid rgba(11, 93, 59, 0.1);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      animation: slideDown 0.3s ease-out;
      min-height: 80px;
      display: flex;
      align-items: center;
      padding: 0 20px;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Contenedor para alinear menú y breadcrumbs */
    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      width: 100%;
      gap: 10px; /* Espacio reducido entre botón y breadcrumbs */
    }
    
    /* Breadcrumbs - ESTILO MEJORADO Y ALINEADO */
    .breadcrumbs-wrapper {
      display: flex;
      align-items: center;
      gap: 5px; /* Espacio reducido entre items */
      flex-wrap: wrap;
      margin-left: 0; /* Eliminar margen izquierdo */
    }
    
    /* Quitamos el icono especial de breadcrumbs */
    .breadcrumb-icon {
      display: none;
    }
    
    .breadcrumb-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .breadcrumb-link {
      color: #6F8F7A;
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      padding: 6px 10px; /* Padding reducido */
      border-radius: 6px;
      background-color: rgba(255, 255, 255, 0.7);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer; /* Mantenemos cursor pointer para navegación */
    }
    
    .breadcrumb-link:hover {
      background-color: #FFFFFF;
      color: #0B5D3B;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .breadcrumb-link i {
      font-size: 12px;
      color: #6F8F7A;
    }
    
    .breadcrumb-link:hover i {
      color: #0B5D3B;
    }
    
    .breadcrumb-current {
      color: #2F2F2A;
      font-size: 14px;
      font-weight: 600;
      padding: 6px 10px; /* Padding reducido */
      background-color: #FFFFFF;
      border-radius: 6px;
      border: 1px solid #E4DDC9;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .breadcrumb-current i {
      color: #0B5D3B;
      font-size: 12px;
    }
    
    .breadcrumb-separator {
      color: #6F8F7A;
      font-size: 12px;
      font-weight: 300;
      margin: 0 2px;
    }
    
    /* Contenido principal - NO SE DESPLAZA CON SIDEBAR */
    .main-content {
      flex: 1;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }
    
    /* Footer - FIJO AL FINAL */
    .footer {
      background: linear-gradient(135deg, #2F2F2A 0%, #4A4A42 100%);
      color: #FAF5E9;
      padding: 25px 20px;
      border-top: 1px solid rgba(250, 245, 233, 0.1);
      margin-top: auto;
    }
    
    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .footer-info {
      flex: 1;
      min-width: 300px;
    }
    
    .footer-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 10px;
      color: #E0B100;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .footer-text {
      color: #E4DDC9;
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.9;
    }
    
    .footer-links {
      display: flex;
      gap: 15px;
    }
    
    .footer-link {
      color: #FAF5E9;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 6px;
      background-color: rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    
    .footer-link:hover {
      background-color: rgba(224, 177, 0, 0.2);
      color: #E0B100;
      transform: translateY(-2px);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        left: -100%;
      }
      
      .sidebar.active {
        left: 0;
      }
      
      .menu-toggle.active {
        left: calc(100% - 70px);
      }
      
      .header-container {
        padding: 0 15px;
        min-height: 70px;
      }
      
      .header-content {
        gap: 8px;
      }
      
      .breadcrumb-link,
      .breadcrumb-current {
        font-size: 13px;
        padding: 5px 8px; /* Padding más reducido en móviles */
      }
      
      .footer-content {
        flex-direction: column;
        text-align: center;
        gap: 15px;
      }
      
      .footer-info {
        min-width: auto;
      }
      
      .main-content {
        padding: 15px;
      }
    }
    
    @media (max-width: 480px) {
      .breadcrumb-link span,
      .breadcrumb-current span {
        display: none;
      }
      
      .breadcrumb-link,
      .breadcrumb-current {
        padding: 5px 6px;
      }
      
      .breadcrumb-link i,
      .breadcrumb-current i {
        margin: 0;
        font-size: 10px;
      }
      
      .breadcrumb-separator {
        margin: 0 1px;
        font-size: 10px;
      }
      
      .menu-toggle {
        width: 45px;
        height: 45px;
        top: 15px;
        left: 15px;
        font-size: 20px;
      }
      
      .header-container {
        padding: 0 10px;
        min-height: 65px;
      }
      
      .header-content {
        gap: 5px;
      }
      
      .footer {
        padding: 20px 15px;
      }
      
      .footer-links {
        flex-direction: column;
        width: 100%;
      }
      
      .footer-link {
        justify-content: center;
      }
    }
    
    /* Estilo para pantallas muy pequeñas */
    @media (max-width: 360px) {
      .header-container {
        padding: 0 8px;
      }
      
      .breadcrumb-link,
      .breadcrumb-current {
        padding: 4px 5px;
        font-size: 12px;
      }
      
      .breadcrumb-separator {
        font-size: 9px;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Botón hamburguesa - VISIBLE SIEMPRE -->
    <button class="menu-toggle" id="menuToggle">
      <i class="fas fa-bars"></i>
    </button>
    
    <!-- Overlay para cerrar menú en móviles -->
    <div class="overlay" id="overlay"></div>
    
    <!-- Menú lateral - OCULTO POR DEFECTO -->
    <!-- En tu menú lateral (sidebar) -->
<nav class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <h2>Sistema de Interacciones</h2>
    <p>Menú de navegación</p>
  </div>
  <ul class="menu-items">
    <li>
      <%= link_to root_path, class: "menu-item", data: {url: "/"} do %>
        <i class="fas fa-home"></i>
        <span>Inicio</span>
      <% end %>
    </li>
    <li>
      <%= link_to dashboard_path, class: "menu-item", data: {url: "/dashboard"} do %>
        <i class="fas fa-database"></i>
        <span>Interacción con DB</span>
      <% end %>
    </li>
    <li>
      <%= link_to error_page_path, class: "menu-item", data: {url: "/error_page"} do %>
        <i class="fas fa-exclamation-triangle"></i>
        <span>Pantalla de Error</span>
      <% end %>
    </li>
    <li>
      <%= link_to personal_data_path, class: "menu-item", data: {url: "/personal_data"} do %>
        <i class="fas fa-user-circle"></i>
        <span>Datos Personales</span>
      <% end %>
    </li>
    <li>
      <%= link_to system_info_path, class: "menu-item", data: {url: "/system_info"} do %>
        <i class="fas fa-server"></i>
        <span>Información del Sistema</span>
      <% end %>
    </li>
  </ul>
</nav>
    
    <!-- HEADER UNIFICADO CON MENÚ Y BREADCRUMBS -->
    <header class="header-container">
      <div class="header-content">
        <!-- Los breadcrumbs dinámicos se insertarán aquí -->
        <div class="breadcrumbs-wrapper" id="breadcrumbsWrapper"></div>
      </div>
    </header>
    
    <!-- Contenido principal - CENTRADO -->
    <main class="main-content" id="mainContent">
      <%= yield %>
    </main>
    
    <!-- Footer - FIJO AL FINAL -->
    <footer class="footer">
      <div class="footer-content">
        <div class="footer-info">
          <h3 class="footer-title">
            <i class="fas fa-shield-check"></i> Sistema Seguro Demo
          </h3>
          <p class="footer-text">
            Aplicación de demostración con interacciones de base de datos, 
            manejo de errores y verificación de seguridad.
          </p>
        </div>
      </div>
    </footer>
  </div>
  
  <!-- JavaScript para breadcrumbs y menú -->
  <script>
    // ============ CONFIGURACIÓN DE MENÚ ============
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const menuItems = document.querySelectorAll('.menu-item');
    const breadcrumbsWrapper = document.getElementById('breadcrumbsWrapper');
    
    // Función para abrir/cerrar menú
    function toggleMenu() {
      const isOpening = !sidebar.classList.contains('active');
      
      sidebar.classList.toggle('active');
      overlay.classList.toggle('active');
      menuToggle.classList.toggle('active');
      
      // Cambiar icono del botón
      const icon = menuToggle.querySelector('i');
      if (sidebar.classList.contains('active')) {
        icon.className = 'fas fa-times';
        // Posicionar botón correctamente cuando sidebar está abierto
        if (window.innerWidth > 768) {
          menuToggle.style.left = '300px';
        } else {
          menuToggle.style.left = 'calc(100% - 70px)';
        }
      } else {
        icon.className = 'fas fa-bars';
        menuToggle.style.left = '20px';
      }
      
      // Prevenir scroll en body cuando menú está abierto
      document.body.style.overflow = isOpening ? 'hidden' : '';
    }
    
    // Inicializar event listeners
    menuToggle.addEventListener('click', toggleMenu);
    overlay.addEventListener('click', toggleMenu);
    
    // Cerrar menú con tecla ESC
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && sidebar.classList.contains('active')) {
        toggleMenu();
      }
    });
    
    // Ajustar posición del botón en resize
    window.addEventListener('resize', () => {
      if (sidebar.classList.contains('active')) {
        if (window.innerWidth > 768) {
          menuToggle.style.left = '300px';
        } else {
          menuToggle.style.left = 'calc(100% - 70px)';
        }
      } else {
        menuToggle.style.left = '20px';
      }
    });
    
    // Marcar elemento activo según la página actual
    function setActiveMenuItem() {
      const currentPath = window.location.pathname;
      menuItems.forEach(item => {
        item.classList.remove('active');
        if (item.dataset.url === currentPath) {
          item.classList.add('active');
        }
      });
    }
    
    // ============ CONFIGURACIÓN DE BREADCRUMBS ============
const breadcrumbsConfig = {
  '/': {
    title: 'Inicio',
    icon: 'fa-home',
    breadcrumbs: []
  },
  '/dashboard': {
    title: 'Interacción con Base de Datos',
    icon: 'fa-database',
    breadcrumbs: [
      { path: '/', title: 'Inicio', icon: 'fa-home' }
    ]
  },
  '/error_page': {
    title: 'Simulación de Error',
    icon: 'fa-exclamation-triangle',
    breadcrumbs: [
      { path: '/', title: 'Inicio', icon: 'fa-home' }
    ]
  },
  '/personal_data': {
    title: 'Datos Personales',
    icon: 'fa-user-circle',
    breadcrumbs: [
      { path: '/', title: 'Inicio', icon: 'fa-home' }
    ]
  },
  '/system_info': {
    title: 'Información del Sistema',
    icon: 'fa-server',
    breadcrumbs: [
      { path: '/', title: 'Inicio', icon: 'fa-home' }
    ]
  },
  
  '/advanced_dashboard': {
    title: 'Dashboard Avanzado',
    icon: 'fa-chart-line',
    breadcrumbs: [
      { path: '/', title: 'Inicio', icon: 'fa-home' },
      { path: '/system_info', title: 'Información del Sistema', icon: 'fa-server' }
    ]
  }
};
    
    // Función para crear breadcrumbs dinámicamente
    function createBreadcrumbs() {
      const currentPath = window.location.pathname;
      const config = breadcrumbsConfig[currentPath] || breadcrumbsConfig['/'];
      
      // Limpiar breadcrumbs existentes
      breadcrumbsWrapper.innerHTML = '';
      
      // Crear breadcrumbs según la configuración
      if (config.breadcrumbs && config.breadcrumbs.length > 0) {
        // Crear breadcrumbs intermedios
        config.breadcrumbs.forEach((crumb, index) => {
          const breadcrumbItem = createBreadcrumbItem(crumb, false);
          breadcrumbsWrapper.appendChild(breadcrumbItem);
          
          // Añadir separador después de cada breadcrumb
          if (index < config.breadcrumbs.length - 1 || (config.breadcrumbs.length === 1 && currentPath !== '/')) {
            const nextSeparator = document.createElement('span');
            nextSeparator.className = 'breadcrumb-separator';
            nextSeparator.textContent = '/';
            breadcrumbsWrapper.appendChild(nextSeparator);
          }
        });
      }
      
      // Añadir breadcrumb actual si no es la página de inicio
      if (currentPath !== '/') {
        const finalSeparator = document.createElement('span');
        finalSeparator.className = 'breadcrumb-separator';
        finalSeparator.textContent = '/';
        breadcrumbsWrapper.appendChild(finalSeparator);
        
        const currentBreadcrumb = createBreadcrumbItem(
          { path: currentPath, title: config.title, icon: config.icon },
          true
        );
        breadcrumbsWrapper.appendChild(currentBreadcrumb);
      }
    }
    
    // Función para crear un elemento de breadcrumb
    function createBreadcrumbItem(crumb, isCurrent = false) {
      const item = document.createElement('div');
      item.className = 'breadcrumb-item';
      
      if (isCurrent) {
        const currentElement = document.createElement('span');
        currentElement.className = 'breadcrumb-current';
        
        if (crumb.icon) {
          const icon = document.createElement('i');
          icon.className = `fas ${crumb.icon}`;
          currentElement.appendChild(icon);
        }
        
        const text = document.createElement('span');
        text.textContent = crumb.title;
        currentElement.appendChild(text);
        
        item.appendChild(currentElement);
      } else {
        const link = document.createElement('a');
        link.href = crumb.path;
        link.className = 'breadcrumb-link';
        
        // QUITAMOS el evento que abre el menú - SOLO NAVEGACIÓN
        link.addEventListener('click', function(e) {
          // Solo navegamos, no abrimos el menú
          if (sidebar.classList.contains('active')) {
            toggleMenu(); // Cerramos menú si está abierto
          }
        });
        
        if (crumb.icon) {
          const icon = document.createElement('i');
          icon.className = `fas ${crumb.icon}`;
          link.appendChild(icon);
        }
        
        const text = document.createElement('span');
        text.textContent = crumb.title;
        link.appendChild(text);
        
        item.appendChild(link);
      }
      
      return item;
    }
    
    // Función para actualizar breadcrumbs dinámicamente
    function updateBreadcrumb(title, icon = null) {
      const currentPath = window.location.pathname;
      if (!breadcrumbsConfig[currentPath]) {
        breadcrumbsConfig[currentPath] = {
          title: title,
          icon: icon,
          breadcrumbs: [
            { path: '/', title: 'Inicio', icon: 'fa-home' }
          ]
        };
      } else {
        breadcrumbsConfig[currentPath].title = title;
        if (icon) breadcrumbsConfig[currentPath].icon = icon;
      }
      createBreadcrumbs();
    }
    
    // Función para navegar y actualizar breadcrumbs
    function navigateWithBreadcrumbs(path, title, icon = null) {
      if (path !== window.location.pathname) {
        if (!breadcrumbsConfig[path]) {
          breadcrumbsConfig[path] = {
            title: title,
            icon: icon,
            breadcrumbs: [
              { path: '/', title: 'Inicio', icon: 'fa-home' },
              ...breadcrumbsConfig[window.location.pathname]?.breadcrumbs || []
            ]
          };
        }
        
        // Cerrar menú si está abierto
        if (sidebar.classList.contains('active')) {
          toggleMenu();
        }
        
        window.location.href = path;
      }
    }
    
    // Inicializar todo cuando se carga la página
    document.addEventListener('DOMContentLoaded', () => {
      setActiveMenuItem();
      createBreadcrumbs();
      
      // Actualizar breadcrumbs cuando cambia la URL
      window.addEventListener('popstate', createBreadcrumbs);
      
      // Ajustar posición inicial del botón
      if (window.innerWidth <= 768) {
        menuToggle.style.fontSize = '20px';
      }
    });
  </script>
</body>
</html>